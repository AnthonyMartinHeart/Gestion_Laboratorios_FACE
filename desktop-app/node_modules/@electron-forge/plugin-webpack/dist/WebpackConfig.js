"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const node_path_1 = __importDefault(require("node:path"));
const debug_1 = __importDefault(require("debug"));
const html_webpack_plugin_1 = __importDefault(require("html-webpack-plugin"));
const webpack_1 = __importDefault(require("webpack"));
const webpack_merge_1 = require("webpack-merge");
const AssetRelocatorPatch_1 = __importDefault(require("./util/AssetRelocatorPatch"));
const processConfig_1 = __importDefault(require("./util/processConfig"));
const rendererTypeUtils_1 = require("./util/rendererTypeUtils");
const d = (0, debug_1.default)('electron-forge:plugin:webpack:webpackconfig');
var RendererTarget;
(function (RendererTarget) {
    RendererTarget[RendererTarget["Web"] = 0] = "Web";
    RendererTarget[RendererTarget["ElectronRenderer"] = 1] = "ElectronRenderer";
    RendererTarget[RendererTarget["ElectronPreload"] = 2] = "ElectronPreload";
    RendererTarget[RendererTarget["SandboxedPreload"] = 3] = "SandboxedPreload";
})(RendererTarget || (RendererTarget = {}));
var WebpackTarget;
(function (WebpackTarget) {
    WebpackTarget["Web"] = "web";
    WebpackTarget["ElectronPreload"] = "electron-preload";
    WebpackTarget["ElectronRenderer"] = "electron-renderer";
})(WebpackTarget || (WebpackTarget = {}));
function isNotNull(item) {
    return item !== null;
}
function rendererTargetToWebpackTarget(target) {
    switch (target) {
        case RendererTarget.Web:
        case RendererTarget.SandboxedPreload:
            return WebpackTarget.Web;
        case RendererTarget.ElectronPreload:
            return WebpackTarget.ElectronPreload;
        case RendererTarget.ElectronRenderer:
            return WebpackTarget.ElectronRenderer;
    }
}
class WebpackConfigGenerator {
    constructor(pluginConfig, projectDir, isProd, port) {
        // Users can override this method in a subclass to provide custom logic or
        // configuration parameters.
        this.preprocessConfig = async (config) => config({}, {
            mode: this.mode,
        });
        this.pluginConfig = pluginConfig;
        this.projectDir = projectDir;
        this.webpackDir = node_path_1.default.resolve(projectDir, '.webpack');
        this.isProd = isProd;
        this.port = port;
        d('Config mode:', this.mode);
    }
    async resolveConfig(config) {
        let rawConfig = typeof config === 'string'
            ? // eslint-disable-next-line @typescript-eslint/no-require-imports
                require(node_path_1.default.resolve(this.projectDir, config))
            : config;
        if (rawConfig && typeof rawConfig === 'object' && 'default' in rawConfig) {
            rawConfig = rawConfig.default;
        }
        return (0, processConfig_1.default)(this.preprocessConfig, rawConfig);
    }
    get mode() {
        return this.isProd ? 'production' : 'development';
    }
    get rendererSourceMapOption() {
        return this.isProd ? 'source-map' : 'eval-source-map';
    }
    rendererEntryPoint(entryPoint, basename) {
        if (this.isProd) {
            return `\`file://$\{require('path').resolve(__dirname, '..', 'renderer', '${entryPoint.name}', '${basename}')}\``;
        }
        const protocol = this.pluginConfig.devServer?.server === 'https' ? 'https' : 'http';
        const baseUrl = `${protocol}://localhost:${this.port}/${entryPoint.name}`;
        return `'${baseUrl}/${basename}'`;
    }
    toEnvironmentVariable(entryPoint, preload = false) {
        const suffix = preload ? '_PRELOAD_WEBPACK_ENTRY' : '_WEBPACK_ENTRY';
        return `${entryPoint.name.toUpperCase().replace(/ /g, '_')}${suffix}`;
    }
    getPreloadDefine(entryPoint) {
        if (!(0, rendererTypeUtils_1.isNoWindow)(entryPoint)) {
            if (this.isProd) {
                return `require('path').resolve(__dirname, '../renderer', '${entryPoint.name}', 'preload.js')`;
            }
            return `'${node_path_1.default.resolve(this.webpackDir, 'renderer', entryPoint.name, 'preload.js').replace(/\\/g, '\\\\')}'`;
        }
        else {
            // If this entry-point has no configured preload script just map this constant to `undefined`
            // so that any code using it still works.  This makes quick-start / docs simpler.
            return 'undefined';
        }
    }
    get allPluginRendererOptions() {
        return Array.isArray(this.pluginConfig.renderer)
            ? this.pluginConfig.renderer
            : [this.pluginConfig.renderer];
    }
    getDefines() {
        const defines = {};
        for (const pluginRendererOptions of this.allPluginRendererOptions) {
            if (!pluginRendererOptions.entryPoints ||
                !Array.isArray(pluginRendererOptions.entryPoints)) {
                throw new Error('Required config option "renderer.entryPoints" has not been defined');
            }
            for (const entryPoint of pluginRendererOptions.entryPoints) {
                const entryKey = this.toEnvironmentVariable(entryPoint);
                if ((0, rendererTypeUtils_1.isLocalWindow)(entryPoint)) {
                    defines[entryKey] = this.rendererEntryPoint(entryPoint, 'index.html');
                }
                else {
                    defines[entryKey] = this.rendererEntryPoint(entryPoint, 'index.js');
                }
                defines[`process.env.${entryKey}`] = defines[entryKey];
                const preloadDefineKey = this.toEnvironmentVariable(entryPoint, true);
                defines[preloadDefineKey] = this.getPreloadDefine(entryPoint);
                defines[`process.env.${preloadDefineKey}`] = defines[preloadDefineKey];
            }
        }
        return defines;
    }
    async getMainConfig() {
        const mainConfig = await this.resolveConfig(this.pluginConfig.mainConfig);
        if (!mainConfig.entry) {
            throw new Error('Required option "mainConfig.entry" has not been defined');
        }
        const fix = (item) => {
            if (typeof item === 'string')
                return fix([item])[0];
            if (Array.isArray(item)) {
                return item.map((val) => val.startsWith('./') ? node_path_1.default.resolve(this.projectDir, val) : val);
            }
            const ret = {};
            for (const key of Object.keys(item)) {
                ret[key] = fix(item[key]);
            }
            return ret;
        };
        mainConfig.entry = fix(mainConfig.entry);
        return (0, webpack_merge_1.merge)({
            devtool: 'source-map',
            target: 'electron-main',
            mode: this.mode,
            output: {
                path: node_path_1.default.resolve(this.webpackDir, 'main'),
                filename: 'index.js',
                libraryTarget: 'commonjs2',
            },
            plugins: [new webpack_1.default.DefinePlugin(this.getDefines())],
            node: {
                __dirname: false,
                __filename: false,
            },
        }, mainConfig || {});
    }
    async getRendererConfig(rendererOptions) {
        const entryPointsForTarget = {
            web: [],
            electronRenderer: [],
            electronPreload: [],
            sandboxedPreload: [],
        };
        for (const entry of rendererOptions.entryPoints) {
            const target = (entry.nodeIntegration ?? rendererOptions.nodeIntegration)
                ? 'electronRenderer'
                : 'web';
            const preloadTarget = (entry.nodeIntegration ?? rendererOptions.nodeIntegration)
                ? 'electronPreload'
                : 'sandboxedPreload';
            if ((0, rendererTypeUtils_1.isPreloadOnly)(entry)) {
                entryPointsForTarget[preloadTarget].push(entry);
            }
            else {
                entryPointsForTarget[target].push(entry);
                if ((0, rendererTypeUtils_1.isLocalWindow)(entry) && entry.preload) {
                    entryPointsForTarget[preloadTarget].push({
                        ...entry,
                        preload: entry.preload,
                    });
                }
            }
        }
        const rendererConfigs = await Promise.all([
            await this.buildRendererConfigs(rendererOptions, entryPointsForTarget.web, RendererTarget.Web),
            await this.buildRendererConfigs(rendererOptions, entryPointsForTarget.electronRenderer, RendererTarget.ElectronRenderer),
            await this.buildRendererConfigs(rendererOptions, entryPointsForTarget.electronPreload, RendererTarget.ElectronPreload),
            await this.buildRendererConfigs(rendererOptions, entryPointsForTarget.sandboxedPreload, RendererTarget.SandboxedPreload),
        ].reduce((configs, allConfigs) => allConfigs.concat(configs)));
        return rendererConfigs.filter(isNotNull);
    }
    buildRendererBaseConfig(target) {
        return {
            target: rendererTargetToWebpackTarget(target),
            devtool: this.rendererSourceMapOption,
            mode: this.mode,
            output: {
                path: node_path_1.default.resolve(this.webpackDir, 'renderer'),
                filename: '[name]/index.js',
                globalObject: 'self',
                ...(this.isProd ? {} : { publicPath: '/' }),
            },
            node: {
                __dirname: false,
                __filename: false,
            },
            plugins: [
                new AssetRelocatorPatch_1.default(this.isProd, target === RendererTarget.ElectronRenderer ||
                    target === RendererTarget.ElectronPreload),
            ],
        };
    }
    async buildRendererConfigForWebOrRendererTarget(rendererOptions, entryPoints, target) {
        if (!(0, rendererTypeUtils_1.isLocalOrNoWindowEntries)(entryPoints)) {
            throw new Error('Invalid renderer entry point detected.');
        }
        const entry = {};
        const baseConfig = this.buildRendererBaseConfig(target);
        const rendererConfig = await this.resolveConfig(rendererOptions.config);
        const output = {
            path: node_path_1.default.resolve(this.webpackDir, 'renderer'),
            filename: '[name]/index.js',
            globalObject: 'self',
            ...(this.isProd ? {} : { publicPath: '/' }),
        };
        const plugins = [];
        for (const entryPoint of entryPoints) {
            entry[entryPoint.name] = (entryPoint.prefixedEntries || []).concat([
                entryPoint.js,
            ]);
            if ((0, rendererTypeUtils_1.isLocalWindow)(entryPoint)) {
                plugins.push(new html_webpack_plugin_1.default({
                    title: entryPoint.name,
                    template: entryPoint.html,
                    filename: `${entryPoint.name}/index.html`,
                    chunks: [entryPoint.name].concat(entryPoint.additionalChunks || []),
                }));
            }
        }
        return (0, webpack_merge_1.merge)(baseConfig, rendererConfig || {}, {
            entry,
            output,
            plugins,
        });
    }
    async buildRendererConfigForPreloadOrSandboxedPreloadTarget(rendererOptions, entryPoints, target) {
        if (entryPoints.length === 0) {
            return null;
        }
        const externals = [
            'electron',
            'electron/renderer',
            'electron/common',
            'events',
            'timers',
            'url',
        ];
        const entry = {};
        const baseConfig = this.buildRendererBaseConfig(target);
        const rendererConfig = await this.resolveConfig(entryPoints[0].preload?.config || rendererOptions.config);
        for (const entryPoint of entryPoints) {
            entry[entryPoint.name] = (entryPoint.prefixedEntries || []).concat([
                entryPoint.preload.js,
            ]);
        }
        const config = {
            target: rendererTargetToWebpackTarget(target),
            entry,
            output: {
                path: node_path_1.default.resolve(this.webpackDir, 'renderer'),
                filename: '[name]/preload.js',
                globalObject: 'self',
                ...(this.isProd ? { publicPath: '' } : { publicPath: '/' }),
            },
            plugins: target === RendererTarget.ElectronPreload
                ? []
                : [new webpack_1.default.ExternalsPlugin('commonjs2', externals)],
        };
        return (0, webpack_merge_1.merge)(baseConfig, rendererConfig || {}, config);
    }
    async buildRendererConfigs(rendererOptions, entryPoints, target) {
        if (entryPoints.length === 0) {
            return [];
        }
        const rendererConfigs = [];
        if (target === RendererTarget.Web ||
            target === RendererTarget.ElectronRenderer) {
            rendererConfigs.push(this.buildRendererConfigForWebOrRendererTarget(rendererOptions, entryPoints, target));
            return rendererConfigs;
        }
        else if (target === RendererTarget.ElectronPreload ||
            target === RendererTarget.SandboxedPreload) {
            if (!(0, rendererTypeUtils_1.isPreloadOnlyEntries)(entryPoints)) {
                throw new Error('Invalid renderer entry point detected.');
            }
            const entryPointsWithPreloadConfig = [], entryPointsWithoutPreloadConfig = [];
            entryPoints.forEach((entryPoint) => (entryPoint.preload.config
                ? entryPointsWithPreloadConfig
                : entryPointsWithoutPreloadConfig).push(entryPoint));
            rendererConfigs.push(this.buildRendererConfigForPreloadOrSandboxedPreloadTarget(rendererOptions, entryPointsWithoutPreloadConfig, target));
            entryPointsWithPreloadConfig.forEach((entryPoint) => {
                rendererConfigs.push(this.buildRendererConfigForPreloadOrSandboxedPreloadTarget(rendererOptions, [entryPoint], target));
            });
            return rendererConfigs;
        }
        else {
            throw new Error('Invalid renderer entry point detected.');
        }
    }
}
exports.default = WebpackConfigGenerator;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2VicGFja0NvbmZpZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9XZWJwYWNrQ29uZmlnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsMERBQTZCO0FBRTdCLGtEQUEwQjtBQUMxQiw4RUFBb0Q7QUFDcEQsc0RBQXdFO0FBQ3hFLGlEQUFzRDtBQVN0RCxxRkFBNkQ7QUFDN0QseUVBQWlEO0FBQ2pELGdFQU1rQztBQUtsQyxNQUFNLENBQUMsR0FBRyxJQUFBLGVBQUssRUFBQyw2Q0FBNkMsQ0FBQyxDQUFDO0FBTy9ELElBQUssY0FLSjtBQUxELFdBQUssY0FBYztJQUNqQixpREFBRyxDQUFBO0lBQ0gsMkVBQWdCLENBQUE7SUFDaEIseUVBQWUsQ0FBQTtJQUNmLDJFQUFnQixDQUFBO0FBQ2xCLENBQUMsRUFMSSxjQUFjLEtBQWQsY0FBYyxRQUtsQjtBQUVELElBQUssYUFJSjtBQUpELFdBQUssYUFBYTtJQUNoQiw0QkFBVyxDQUFBO0lBQ1gscURBQW9DLENBQUE7SUFDcEMsdURBQXNDLENBQUE7QUFDeEMsQ0FBQyxFQUpJLGFBQWEsS0FBYixhQUFhLFFBSWpCO0FBRUQsU0FBUyxTQUFTLENBQUksSUFBYztJQUNsQyxPQUFPLElBQUksS0FBSyxJQUFJLENBQUM7QUFDdkIsQ0FBQztBQUVELFNBQVMsNkJBQTZCLENBQUMsTUFBc0I7SUFDM0QsUUFBUSxNQUFNLEVBQUUsQ0FBQztRQUNmLEtBQUssY0FBYyxDQUFDLEdBQUcsQ0FBQztRQUN4QixLQUFLLGNBQWMsQ0FBQyxnQkFBZ0I7WUFDbEMsT0FBTyxhQUFhLENBQUMsR0FBRyxDQUFDO1FBQzNCLEtBQUssY0FBYyxDQUFDLGVBQWU7WUFDakMsT0FBTyxhQUFhLENBQUMsZUFBZSxDQUFDO1FBQ3ZDLEtBQUssY0FBYyxDQUFDLGdCQUFnQjtZQUNsQyxPQUFPLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQztJQUMxQyxDQUFDO0FBQ0gsQ0FBQztBQUVELE1BQXFCLHNCQUFzQjtJ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